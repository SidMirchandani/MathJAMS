<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Math JAMS</title>
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Sofia+Sans+Extra+Condensed:ital,wght@0,1..1000;1,1..1000&display=swap"
      rel="stylesheet"
    />
    <!-- External CSS -->
    <link rel="stylesheet" href="styles.css" />
    <!-- Favicon -->
    <link
      rel="icon"
      href="https://i.postimg.cc/2jv9GmfM/Read-JAMS-1.png"
      type="image/x-icon"
    />
    <!-- Firebase SDKs (v8) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <!--
      IMPORTANT:
      In your CSS, include these rules (or similar):
      
      .topic-content { display: block; }
      .topic-content.collapsed { display: none; }
    -->
  </head>
  <body>
    <!-- Header Section -->
    <section id="home">
      <header>
        <img
          src="https://i.postimg.cc/2jv9GmfM/Read-JAMS-1.png"
          alt="Math JAMS Logo"
        />
      </header>
      <subheader>
        <div>
          <!-- Use href instead of src for links -->
          <a href="https://nordvpn.com/">
            <img
              src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSGjryC__w5W7qqVkw8wmLh914my0tHoUNaeA&s"
              height="30px"
              alt="NordVPN"
            />
          </a>
          <a href="https://nordpass.com/">
            <img
              src="https://bestreviews.net/wp-content/uploads/2024/06/nordpass-logo.svg"
              height="30px"
              alt="NordPass"
            />
          </a>
        </div>
      </subheader>
    </section>

    <!-- Navigation Bar -->
    <nav>
      <div class="container">
        <ul>
          <li>
            <img
              src="https://i.postimg.cc/mD9jm3KC/MATH.png"
              alt="Math JAMS Logo"
              style="float: right;"
              height="50px"
            />
          </li>
        </ul>
        <span class="star-counter" id="star-system">⭐ 0</span>
      </div>
    </nav>

    <!-- Main Content -->
    <main>
      <!-- Compete Section -->
      <section id="compete" class="section">
        <h3>COMPETE</h3>
        <div class="cards">
          <a class="card" href="https://jams.edison.k12.nj.us/">
            <b>LOCATION: </b> John Adams Middle School, Edison, NJ.
          </a>
          <a class="card" href="https://jams.edison.k12.nj.us/">
            <b>WHO CAN APPLY: </b> All students in Edison from grades 3-8!
          </a>
          <a class="card" href="https://jams.edison.k12.nj.us/">
            <b>DIVISIONS: </b> JUNIOR (grades 3-5) and SENIOR (grades 6-8).
          </a>
          <a class="card" href="https://jams.edison.k12.nj.us/">
            <b>TIMINGS: </b> Dates and timings will be posted soon!
          </a>
          <a class="card" href="https://jams.edison.k12.nj.us/">
            <b>PRICING: </b> $2 per participant.
          </a>
          <a class="card" href="https://jams.edison.k12.nj.us/">
            <b>PRIZES: </b> Prizes will be posted soon!
          </a>
          <a class="card" id="join" href="https://jams.edison.k12.nj.us/">
            <strong>JOIN HERE!</strong>
          </a>
        </div>
      </section>

      <!-- User Login Section -->
      <section id="user-login" class="section">
        <h3>Track Your Progress</h3>
        <form id="user-form">
          <!-- This expects a 7-digit username -->
          <input type="text" id="username" placeholder="Your 7-digit Username" />
          <button type="submit">Start Tracking</button>
          <p id="user-message"></p>
        </form>
      </section>

      <!-- Problems Section -->
      <section id="problems" class="section">
        <h3>Questions!</h3>

        <!-- Topic 1 -->
        <div class="topic-card">
          <h4 class="topic-title">Topic A: Linear Equations</h4>
          <!-- Note the use of "collapsed" (instead of "hidden") -->
          <div class="topic-content collapsed">
            <div class="book-card" data-problem-id="problemA1" data-correct-answer="3" data-title="Question A1">
              <b>QUESTION A1:</b> Solve for x: 2x + 1 = 7.
            </div>
            <div class="book-card" data-problem-id="problemA2" data-correct-answer="5" data-title="Question A2">
              <b>QUESTION A2:</b> Solve for x: x - 4 = 1.
            </div>
            <div class="book-card" data-problem-id="problemA3" data-correct-answer="8" data-title="Question A3">
              <b>QUESTION A3:</b> Solve for x: x/2 = 4.
            </div>
            <div class="book-card" data-problem-id="problemA4" data-correct-answer="2" data-title="Question A4">
              <b>QUESTION A4:</b> Solve for x: 3x = 6.
            </div>
            <div class="book-card" data-problem-id="problemA5" data-correct-answer="10" data-title="Question A5">
              <b>QUESTION A5:</b> Solve for x: x + 7 = 17.
            </div>
            <!-- Add additional Topic A problems as needed -->
          </div>
        </div>

        <!-- Topic 2 -->
        <div class="topic-card">
          <h4 class="topic-title">Topic B: Quadratic Equations</h4>
          <div class="topic-content collapsed">
            <div class="book-card" data-problem-id="problemB1" data-correct-answer="3" data-title="Question B1">
              <b>QUESTION B1:</b> Find the greater solution: x² - 2x - 3 = 0.
            </div>
            <div class="book-card" data-problem-id="problemB2" data-correct-answer="4" data-title="Question B2">
              <b>QUESTION B2:</b> Find the greater solution: x² - 6x + 8 = 0.
            </div>
            <div class="book-card" data-problem-id="problemB3" data-correct-answer="5" data-title="Question B3">
              <b>QUESTION B3:</b> Find the greater solution: x² - 10x + 25 = 0.
            </div>
            <!-- Add additional Topic B problems as needed -->
          </div>
        </div>

        <!-- Topic 3 -->
        <div class="topic-card">
          <h4 class="topic-title">Topic C: Coordinate Transformations</h4>
          <div class="topic-content collapsed">
            <div class="book-card" data-problem-id="problemC1" data-correct-answer="(4, -2)" data-title="Question C1">
              <b>QUESTION C1:</b> A point (2, 3) is translated 2 units to the right and 5 units down. What are the new coordinates?
            </div>
            <div class="book-card" data-problem-id="problemC2" data-correct-answer="(1, 7)" data-title="Question C2">
              <b>QUESTION C2:</b> A point (4, 2) is reflected across the line y = 4.5. What are the new coordinates?
            </div>
            <div class="book-card" data-problem-id="problemC3" data-correct-answer="(-1, 3)" data-title="Question C3">
              <b>QUESTION C3:</b> A point (3, 1) is rotated 90° counterclockwise about the origin. What are the new coordinates?
            </div>
            <!-- Add additional Topic C problems as needed -->
          </div>
        </div>
      </section>

      <!-- Leaderboard Section -->
      <section id="leaderboard" class="section">
        <h3>Leaderboard</h3>
        <ul id="leaderboard-list"></ul>
      </section>

      <!-- Popup Section -->
      <div id="book-popup" class="popup collapsed">
        <div class="popup-content">
          <span class="close-btn">&times;</span>
          <h2 id="popup-book-title">Book Title</h2>
          <input
            type="text"
            id="popup-username"
            class="popup-input"
            placeholder="Enter your answer"
          />
          <a id="popup-link" class="popup-button" href="#" target="_blank">
            Check
          </a>
          <button id="report-button" class="popup-button report-button">
            Report Question
          </button>
        </div>
      </div>
    </main>

    <!-- Footer Section -->
    <footer>
      <div class="container" id="final">
        <p>
          &copy; This is a John Adams Middle School 501(c)(3) Organization.
        </p>
      </div>
    </footer>

    <!-- Firebase Configuration and Initialization -->
    <script>
      // Replace the placeholder values with your Firebase project settings.
      var firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID"
      };
      firebase.initializeApp(firebaseConfig);
      var db = firebase.firestore();
    </script>

    <!-- JavaScript Code -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // DOM Elements
        const bookCards = document.querySelectorAll('.book-card');
        const topics = document.querySelectorAll('.topic-card');
        const popup = document.getElementById('book-popup');
        const popupTitle = document.getElementById('popup-book-title');
        const popupInput = document.getElementById('popup-username');
        const popupButton = document.getElementById('popup-link');
        const closeBtn = document.querySelector('.close-btn');
        const reportButton = document.getElementById('report-button');
        const starSystem = document.getElementById('star-system');
        const userForm = document.getElementById('user-form');
        const emailInput = document.getElementById('username');
        const userMessage = document.getElementById('user-message');
        const leaderboardList = document.getElementById('leaderboard-list');

        let correctAnswer = "";
        let problemID = "";
        let username = ""; // In this case, a 7-digit username is expected

        // Handle username submission
        userForm.addEventListener('submit', (event) => {
          event.preventDefault();
          const inputUsername = emailInput.value.trim();
          if (/^\d{7}$/.test(inputUsername)) { // Validate as 7-digit number
            username = inputUsername;
            const userProgress = JSON.parse(localStorage.getItem('userProgress')) || {};
            const userStars = userProgress[username]?.stars || 0;
            starSystem.textContent = `⭐ ${userStars}`;
            userMessage.textContent = `Welcome, ${username}! Your progress is now being tracked.`;
            userMessage.style.color = "";
            if (!userProgress[username]) {
              userProgress[username] = { stars: 0, solvedProblems: [] };
              localStorage.setItem('userProgress', JSON.stringify(userProgress));
            }
          } else {
            userMessage.textContent = 'Please enter a valid 7-digit username.';
            userMessage.style.color = 'red';
            setTimeout(() => (userMessage.textContent = ''), 3000);
          }
        });

        // Expand/collapse topics
        topics.forEach(topic => {
          const title = topic.querySelector('.topic-title');
          const content = topic.querySelector('.topic-content');
          title.addEventListener('click', () => {
            content.classList.toggle('collapsed');
          });
        });

        // Show popup on book-card click
        bookCards.forEach(card => {
          card.addEventListener('click', (event) => {
            event.preventDefault();
            if (!username) {
              alert('Please enter your username first to start tracking progress.');
              return;
            }
            problemID = card.getAttribute('data-problem-id');
            correctAnswer = card.getAttribute('data-correct-answer');
            const title = card.getAttribute('data-title');
            popupTitle.textContent = title;
            popupInput.value = "";
            popupInput.style.borderColor = "";
            popup.classList.add('visible');
          });
        });

        // Close popup
        closeBtn.addEventListener('click', () => {
          popup.classList.remove('visible');
        });

        // Check Answer
        popupButton.addEventListener('click', (event) => {
          event.preventDefault();
          const userAnswer = popupInput.value.trim();
          const userProgress = JSON.parse(localStorage.getItem('userProgress')) || {};
          const userStars = userProgress[username]?.stars || 0;
          const solvedProblems = userProgress[username]?.solvedProblems || [];
  
          if (solvedProblems.includes(problemID)) {
            popupInput.style.borderColor = 'orange';
          } else if (userAnswer === correctAnswer) {
            popupInput.style.borderColor = 'green';
            userProgress[username].stars = userStars + 1;
            userProgress[username].solvedProblems.push(problemID);
            localStorage.setItem('userProgress', JSON.stringify(userProgress));
            starSystem.textContent = `⭐ ${userProgress[username].stars}`;
          } else {
            popupInput.style.borderColor = 'red';
            setTimeout(() => {
              popupInput.style.borderColor = '';
            }, 500);
          }
        });

        // Report Question Functionality
        reportButton.addEventListener('click', () => {
          if (!username) {
            alert('Please log in with your username to report a question.');
            return;
          }
          const reportMessage = `The question "${popupTitle.textContent}" has been reported. Thank you!`;
          alert(reportMessage);
          const reports = JSON.parse(localStorage.getItem('reportedQuestions')) || [];
          reports.push({ username, question: popupTitle.textContent, timestamp: new Date().toISOString() });
          localStorage.setItem('reportedQuestions', JSON.stringify(reports));
        });
  
        // Load saved data from localStorage when the page loads
        const savedData = JSON.parse(localStorage.getItem('userProgress')) || {};
        if (username in savedData) {
          const userStars = savedData[username].stars;
          starSystem.textContent = `⭐ ${userStars}`;
          userMessage.textContent = `Welcome back, ${username}! Your progress is being tracked.`;
        }
      });
    </script>
  </body>
</html>
